if(MSVC AND NOT "${MSVC_VERSION}" LESS 1400)
	add_definitions("/MP")
endif()

add_definitions(
	-DTW_STATIC
	-DTW_NO_LIB_PRAGMA
	-DTW_NO_DIRECT3D
	-DGLEW_STATIC
	-D_CRT_SECURE_NO_WARNINGS
	)

# GLFW
set(GLFW_BUILD_EXAMPLES OFF CACHE BOOL "")
set(GLFW_BUILD_TESTS OFF CACHE BOOL "")
set(GLFW_BUILD_DOCS OFF CACHE BOOL "")
set(GLFW_INSTALL OFF CACHE BOOL "")
add_subdirectory(glfw)

include_directories(
	glfw/include/GLFW/
	glew/include/
	)

if(${CMAKE_SYSTEM_NAME} MATCHES "Linux")
	set(OPENGL_LIBRARIES
		${OPENGL_LIBRARY}
		-lGL -lGLU -lXrandr -lXext -lX11 -lrt
		${CMAKE_DL_LIBS}
		#glfw
		#${OPENGL_glu_LIBRARY}
		${GLFW_LIBRARIES}
		)
elseif(${CMAKE_SYSTEM_NAME} MATCHES "Darwin")
	set(OPENGL_LIBRARIES
		${OPENGL_LIBRARY}
		${CMAKE_DL_LIBS}
		${GLFW_LIBRARIES}
		)
endif(${CMAKE_SYSTEM_NAME} MATCHES "Linux")

#GLEW
set(GLEW_SOURCE
	glew/src/glew.c)

set(GLEW_HEADERS
	)

add_library(GLEW STATIC
	${GLEW_SOURCE}
	${GLEW_INCLUDE}
	)

target_link_libraries(GLEW
	${OPENGL_LIBRARIES}
	${EXTRA_LIBS}
	)

# Assimp
include(CheckIncludeFile)
include(CheckTypeSize)
include(CheckFunctionExists)
include_directories(assimp/include)
set(LIB_INSTALL_DIR "lib")
set(LIBASSIMP_COMPONENT libassimp)
set(ZLIB_LIBRARIES zlib)
set(BUILD_STATIC_LIB ON)

set(ASSIMP_BUILD_3DS_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_3D_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_AC_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_ASE_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_ASSBIN_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_ASSXML_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_B3D_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_BLEND_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_BVH_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_COB_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_COLLADA_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_CSM_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_DXF_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_FBX_IMPORTER ON CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_HMP_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_IFC_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_IRR_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_LWO_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_LWS_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_MD2_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_MD3_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_MD5_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_MDC_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_MDL_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_MS3D_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_NDO_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_NFF_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_OBJ_IMPORTER ON CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_OFF_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_OGRE_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_OPENGEX_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_PLY_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_Q3BSP_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_Q3D_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_RAW_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_SMD_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_STL_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_TERRAGEN_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_XGL_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_X_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_AMF_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_IRRMESH_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_SIB_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_X3D_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_GLTF_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_3MF_IMPORTER OFF CACHE BOOL "" FORCE)
set(ASSIMP_BUILD_MMD_IMPORTER OFF CACHE BOOL "" FORCE)

mark_as_advanced(
  ASSIMP_BUILD_3DS_IMPORTER
  ASSIMP_BUILD_3D_IMPORTER
  ASSIMP_BUILD_AC_IMPORTER
  ASSIMP_BUILD_ASE_IMPORTER
  ASSIMP_BUILD_ASSBIN_IMPORTER
  ASSIMP_BUILD_ASSXML_IMPORTER
  ASSIMP_BUILD_B3D_IMPORTER
  ASSIMP_BUILD_BLEND_IMPORTER
  ASSIMP_BUILD_BVH_IMPORTER
  ASSIMP_BUILD_COB_IMPORTER
  ASSIMP_BUILD_COLLADA_IMPORTER
  ASSIMP_BUILD_CSM_IMPORTER
  ASSIMP_BUILD_DXF_IMPORTER
  ASSIMP_BUILD_FBX_IMPORTER
  ASSIMP_BUILD_HMP_IMPORTER
  ASSIMP_BUILD_IFC_IMPORTER
  ASSIMP_BUILD_IRR_IMPORTER
  ASSIMP_BUILD_LWO_IMPORTER
  ASSIMP_BUILD_LWS_IMPORTER
  ASSIMP_BUILD_MD2_IMPORTER
  ASSIMP_BUILD_MD3_IMPORTER
  ASSIMP_BUILD_MD5_IMPORTER
  ASSIMP_BUILD_MDC_IMPORTER
  ASSIMP_BUILD_MDL_IMPORTER
  ASSIMP_BUILD_MS3D_IMPORTER
  ASSIMP_BUILD_NDO_IMPORTER
  ASSIMP_BUILD_NFF_IMPORTER
  ASSIMP_BUILD_OBJ_IMPORTER
  ASSIMP_BUILD_OFF_IMPORTER
  ASSIMP_BUILD_OGRE_IMPORTER
  ASSIMP_BUILD_OPENGEX_IMPORTER
  ASSIMP_BUILD_PLY_IMPORTER
  ASSIMP_BUILD_Q3BSP_IMPORTER
  ASSIMP_BUILD_Q3D_IMPORTER
  ASSIMP_BUILD_RAW_IMPORTER
  ASSIMP_BUILD_SMD_IMPORTER
  ASSIMP_BUILD_STL_IMPORTER
  ASSIMP_BUILD_TERRAGEN_IMPORTER
  ASSIMP_BUILD_XGL_IMPORTER
  ASSIMP_BUILD_X_IMPORTER
  ASSIMP_BUILD_AMF_IMPORTER
  ASSIMP_BUILD_IRRMESH_IMPORTER
  ASSIMP_BUILD_SIB_IMPORTER
  ASSIMP_BUILD_X3D_IMPORTER
  ASSIMP_BUILD_GLTF_IMPORTER
  ASSIMP_BUILD_3MF_IMPORTER
  ASSIMP_BUILD_MMD_IMPORTER)

set(ASSIMP_LIB_INSTALL_DIR ${PROJECT_BINARY_DIR})

add_subdirectory(assimp/contrib/zlib) # Built-in, modified Zlib
set(ZLIB_FOUND 1)
set(ZLIB_LIBRARIES zlibstatic)
set_target_properties(zlibstatic PROPERTIES LINKER_LANGUAGE CXX)

## Compile without Boost
include_directories(assimp/code/BoostWorkaround)
add_definitions(-DASSIMP_BUILD_BOOST_WORKAROUND)
add_definitions(-DASSIMP_BUILD_NO_EXPORT)
add_definitions(-DASSIMP_BUILD_NO_3DS_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_AC_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_ASE_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_B3D_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_BLEND_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_BVH_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_COB_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_COLLADA_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_CSM_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_DXF_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_STL_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_PLY_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_HMP_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_IFC_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_X_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_MDL_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_MD3_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_MD2_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_SMD_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_MDC_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_LWO_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_LWS_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_NFF_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_RAW_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_OFF_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_IRRMESH_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_IRR_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_Q3D_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_TERRAGEN_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_3D_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_OGRE_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_MS3D_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_Q3BSP_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_NDO_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_XGL_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_C4D_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_AMF_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_SIB_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_X3D_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_GLTF_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_3MF_IMPORTER)
add_definitions(-DASSIMP_BUILD_NO_MMD_IMPORTER)

## Compile Assimp
set(GIT_COMMIT_HASH 0)
configure_file(
  assimp/revision.h.in
  ${CMAKE_BINARY_DIR}/external/assimp/code/revision.h
  )
#configure_file(
#  assimp/include/assimp/config.h.in
#  ${CMAKE_BINARY_DIR}/external/assimp/include/assimp/config.h
#  )
include_directories(${CMAKE_BINARY_DIR}/external/assimp/code)
add_subdirectory(assimp/code)

